{% extends 'base.html.twig' %}

{% block title %}
Compte utilisateur - Portail utilisateur LEMNIA
{% endblock %}

{% block body %}
    <!--Contenu de la page-->
    <main class="main-content row">
        <h3>Votre compte utilisateur</h3>
        <section class="col s12 l12">
            <div class="row">
                <!--Affichage du tableau de tout les utilisateurs-->
                <div class="col s12 m5">
                    <div class="card">
                        <div class="card-action" id="ma_info_perso">
                            <div class="co_contactInfoBlock_contacts">
                                <div class="ma_titreBlock_user">
                                    <span class="title_card" id="ma_title_infos_perso">Informations personnelles</span>
                                    <a class="grey-text" id="ma_modif_info_perso" href="#"><i class="material-icons" id="edit" style="font-size:20px">edit</i><i class="material-icons white-text" id="close" style="font-size:20px">clear</i></a>
                                </div>
                                {{ form_start(formInfoPerso) }}
                                <div class="co_contactInfoTopBlock_contacts">
                                    <div class="co_nameCircle" id="ma_nameCircle">
                                        <p class="white-text" id="ma_initial_info_perso" style="font-size: 22px">{{initial}}</p>
                                    </div>
                                    <div class="co_contactInfoTopBlockText_contacts ma_apercu_info_perso">
                                        <p class="grey-text text-lighten-1" style="font-size: 16px">{{user.getFirstName}} {{user.getLastName}}</p>
                                        <p class="grey-text text-lighten-1" style="font-size: 12px">{{user.getJob}}</p>
                                        <p class="grey-text text-lighten-1" style="font-size: 12px">{{user.getSocity}}</p>
                                    </div>
                                    <div class="co_contactInfoTopBlockText_contacts ma_modifier_info ma_modifier_info_perso white-text">
                                        {{ form_widget(formInfoPerso.lastname, {'value': user.getLastName }) }}
                                        {{ form_widget(formInfoPerso.firstname, {'value': user.getFirstName }) }}
                                    </div>
                                </div>
                                <div class="co_contactInfoMiddleBlock_contacts ma_apercu_info_perso">
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal">
                                        <i class="material-icons grey-text text-lighten-1" >location_on</i>
                                        <p class="grey-text text-lighten-1 white-text" style="font-size: 12px">{{user.getAdresse}}, {{user.getCodePostal}} {{user.getCity}}, {{user.getNation}}</p>
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal">
                                        <i class="material-icons grey-text text-lighten-1">email</i>
                                        <p class="grey-text text-lighten-1 white-text" style="font-size: 12px">{{user.getEmail}}</p>
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal">
                                        <i class="material-icons grey-text text-lighten-1">phone</i>
                                        <p class="grey-text text-lighten-1 white-text" style="font-size: 12px">{{user.getPhoneNumber}}</p>
                                    </div>
                                </div>
                                <div class="co_contactInfoMiddleBlock_contacts ma_modifier_info_perso">
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_widget(formInfoPerso.socity, {'value': user.getSocity }) }}
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_widget(formInfoPerso.job, {'value': user.getJob }) }}
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_widget(formInfoPerso.pays, {'value': user.getNation }) }}
                                        {{ form_widget(formInfoPerso.ville, {'value': user.getCity }) }}
                                        {{ form_widget(formInfoPerso.cPostal, {'value': user.getCodePostal }) }}
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_widget(formInfoPerso.adresse, {'value': user.getAdresse }) }}
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_widget(formInfoPerso.telephone, {'value': user.getPhoneNumber }) }}
                                        {{ form_widget(formInfoPerso.email, {'value': user.getEmail }) }}
                                    </div>
                                </div>
                                <div id="validerInfos">
                                    <button class="waves-effect waves-light btn blue blue-lighten-3 col s6 offset-s3" type="submit">Valider les modifications</button>
                                </div>
                                {{ form_end(formInfoPerso) }}
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-action" id="ma_info_co">
                            <div class="co_contactInfoBlock_contacts">
                                <div class="ma_titreBlock_user">
                                    <span class="title_card" id="ma_title_infos_co">Informations de connexion</span>
                                    <a class="grey-text" id="ma_modif_info_co" href="#"><i class="material-icons" id="editInfosCo" style="font-size:18px">edit</i><i class="material-icons white-text" id="closeInfosCo" style="font-size:20px">clear</i></a>
                                </div>
                                <div class="co_contactInfoMiddleBlock_contacts" id="ma_apercu_infos_co">
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal">
                                        <i class="material-icons grey-text text-lighten-1" >assignment_ind</i>
                                        <p class="grey-text text-lighten-1" style="font-size: 12px">{{user}}</p>
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal">
                                        <i class="material-icons grey-text text-lighten-1">enhanced_encryption</i>
                                        <p class="grey-text text-lighten-1" style="font-size: 12px">{{user.getPassword}}</p>
                                    </div>
                                </div>
                                <div class="co_contactInfoMiddleBlock_contacts" id="ma_modifier_infos_co">
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {{ form_start(formConnexion) }}
                                            {{ form_widget(formConnexion.pseudo, {'value': user}) }}
                                    </div>
                                    <a class="white-text" style="font-size:0.8em" href="{{ path('fos_user_resetting_request') }}">Modifier Mots de passe</a>
                                    <div id="validerInfosCo ">
                                        <button class="waves-effect waves-light btn buttonUser col s6 offset-s3" data-action="save-jpg" type="submit">Valider les modifications</button>
                                        {{ form_end(formConnexion) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 m7">
                    <div class="card">
                        <div class="card-action" id="ma_sepa" style="padding-bottom:50px">
                            <div>
                                <div class="ma_titreBlock_user">
                                    <span class="title_card" id="ma_title_sepa">Votre mandat SEPA</span>
                                    <a class="grey-text" id="ma_modif_sepa" href="#"><i class="material-icons" id="editSepa" style="font-size:18px">edit</i><i class="material-icons white-text" id="closeSepa" style="font-size:20px">clear</i></a>
                                </div>
                                <div id="ma_apercu_sepa">
                                {% if sepa != null %}
                                    <table>
                                        <tbody>
                                            <tr>
                                                <td class="grey-text" style="font-size: 16px">IBAN</td>
                                                <td class="grey-text text-lighten-1" style="font-size: 14px">{{sepa.getIban}}</td>
                                            </tr>
                                            <tr>
                                                <td class="grey-text" style="font-size: 16px">BIC</td>
                                                <td class="grey-text text-lighten-1" style="font-size: 14px">{{sepa.getBic}}</td>
                                            </tr>
                                            <tr>
                                                <td class="grey-text" style="font-size: 16px">DATE</td>
                                                <td class="grey-text text-lighten-1" style="font-size: 14px">{{sepa.getDateSignature|date("d/m/Y")}}</td>
                                            </tr>
                                            <tr>
                                                <td class="grey-text" style="font-size: 16px;vertical-align:text-top">SIGNATURE</td>
                                                {% if sepa.getSignature != null %}
                                                <td class="grey-text" style="font-size: 16px"><img src="{{sepa.getSignature}}" alt="signature"/></td>
                                                {% endif %}
                                            </tr>
                                        </tbody>
                                    </table>
                                 {% endif %}
                                </div>
                                <div class="co_contactInfoMiddleBlock_contacts" id="ma_modifier_sepa">
                                    {{ form_start(formSepa) }}
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {% if sepa != null %}
                                            {{ form_widget(formSepa.iban,{'value': sepa.getIban }) }}
                                        {% else %}
                                            {{ form_widget(formSepa.iban) }}
                                        {% endif %}
                                    </div>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info white-text">
                                        {% if sepa != null %}
                                            {{ form_widget(formSepa.bic, {'value': sepa.getBic }) }}
                                        {% else %}
                                            {{ form_widget(formSepa.bic) }}
                                        {% endif %}
                                    </div>

                                    <label for="signature" class="white-text">Signature électronique</label>
                                    <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info">
                                        <canvas class="pad" id="pad" width="300" height="150"></canvas>
                                        {{form_widget(formSepa.signature)}}
                                        {% if sepa != null %}
                                            <p class="white-text" id="dateSignature" style="font-size: 14px">Signé le {{sepa.getDateSignature|date('d/m/Y')}}</p>
                                        {% endif %}
                                    </div>
                                    <div id="validerSepa">
                                        <button id="boutonSepa" class="waves-effect waves-light btn buttonUser col s4 offset-s4" type="submit">Valider les modifications</button>
                                    </div>
                                    {{ form_end(formSepa) }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="margin-bottom:0px" id="tableCard">
                        <div class="card-action">
                            <div>
                                <div class="ma_titreBlock_user">
                                    <span class="title_card">Vos cartes bancaires</span>
                                </div>
                                <div class="ma_carteBancaire_contenu">
                                    <table class="bordered grey-text">
                                        <thead>
                                            <tr>
                                               <th>#</th>
                                               <th>Type</th>
                                               <th>NUMERO DE CARTE</th>
                                               <th>DATE D'EXPIRATION</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for carteBancaire in carteBancaires %}
                                            <tr>
                                                <td>{% set counter = ( counter | default(0) ) + 1 %} {{ counter }}</td>
                                                <td>{{carteBancaire.getType}}</td>
                                                <td>{{carteBancaire.getNumeroCarte}}</td>
                                                <td>{{carteBancaire.getDateExpiration|date('m/Y')}}</td>
                                                <td><a href="{{path('lemnia_customer_portal_delete_credit_card',{'id':carteBancaire.getId})}}"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 32"><title>bin</title><path fill="#9ea4b4" d="M4 10v20c0 1.1 0.9 2 2 2h18c1.1 0 2-0.9 2-2v-20h-22zM10 28h-2v-14h2v14zM14 28h-2v-14h2v14zM18 28h-2v-14h2v14zM22 28h-2v-14h2v14z"></path><path fill="#9ea4b4" d="M26.5 4h-6.5v-2.5c0-0.825-0.675-1.5-1.5-1.5h-7c-0.825 0-1.5 0.675-1.5 1.5v2.5h-6.5c-0.825 0-1.5 0.675-1.5 1.5v2.5h26v-2.5c0-0.825-0.675-1.5-1.5-1.5zM18 4h-6v-1.975h6v1.975z"></path></svg></a></td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    <a class="btn buttonUser modal-trigger" id="addNewCard" href="#">Ajoutez une carte</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="margin-top:0px;" id="addCard">
                        <div class="card-action ma_modifyBackground">
                            <div>
                                {{ form_start(formCarteBancaire) }}
                                <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info">
                                    {{form_widget(formCarteBancaire.type)}}
                                    {{form_widget(formCarteBancaire.numeroCarte,{'type': 'number'})}}
                                </div>
                                <div class="co_contactOneInfoMiddleBlock_contacts horizontal ma_modifier_info">
                                    <p style="margin-right:20px; font-size:14px;color:white ">Date d'expiration: </p>
                                    {{form_widget(formCarteBancaire.dateExpiration)}}
                                    {{form_widget(formCarteBancaire.pictogramme,{'type': 'number'})}}
                                </div>
                                <div class="ma_carteBancaire_contenu">
                                    <button class="waves-effect waves-light btn buttonUser col s6 offset-s3" type="submit" id="buttonAddCard">Ajoutez la carte</button>
                                </div>
                                {{form_end(formCarteBancaire)}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
    <script src="{{ asset('js/user.js') }}"></script>
{% endblock %}

{% block stylesheets %}
<style>
    body { background: #F5F5F5; font: 18px/1.5 sans-serif; overflow-x: hidden; }
    h1, h2 { line-height: 1.2; margin: 0 0 .5em; }
    h1 { font-size: 36px; }
    h2 { font-size: 21px; margin-bottom: 1em; }
    p { margin: 0 0 1em 0; }
    a { color: #0000F0; }
    a:hover { text-decoration: none; }
    code { background: #F5F5F5; max-width: 100px; padding: 2px 6px; word-wrap: break-word; }
    #wrapper { background: #FFF; margin: 1em auto; max-width: 800px; width: 95%; }
    #container { padding: 2em; }
    #welcome, #status { margin-bottom: 2em; }
    #welcome h1 span { display: block; font-size: 75%; }
    #icon-status, #icon-book { float: left; height: 64px; margin-right: 1em; margin-top: -4px; width: 64px; }
    #icon-book { display: none; }
    
    @media (min-width: 768px) {
        #wrapper { width: 80%; margin: 2em auto; }
        #icon-book { display: inline-block; }
        #status a, #next a { display: block; }

        @-webkit-keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        .sf-toolbar { opacity: 0; -webkit-animation: fade-in 1s .2s forwards; animation: fade-in 1s .2s forwards;}
    }

</style>
{% endblock %}

